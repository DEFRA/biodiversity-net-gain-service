{% extends 'form-layout.html' %}
{% from "common/generate-summary-list-macro.njk" import generateSummaryList %}
{% set pageHeading = "Check your answers before submitting your information" %}

{% block formContent %}
  <div class="govuk-body">
    {% if err %}
      {% include "errorbanner.html" %}
    {% endif %}
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <h1 class="govuk-heading-xl">
          {{ pageHeading }}
        </h1>
        <!--Land boundary-->
        <h2 class="govuk-heading-l">Land boundary</h2>
        
        {% set landBoundaryUploadTypeElement = {
          key: {
              text: "Land boundary file type"
          },
          value: {
            html: "<span data-testid=\"land-boundary-file-type-value\">" + landBoundaryUploadType + "</span>"
          },
          actions: {
            items: [
                {
                    href: routes.CHOOSE_LAND_BOUNDARY_UPLOAD if ENABLE_ROUTE_SUPPORT_FOR_GEOSPATIAL === 'Y' else routes.UPLOAD_LAND_BOUNDARY,
                    text: "Change",
                    visuallyHiddenText: " land boundary file",
                    attributes: {
                        id: "check-land-boundary-file-type"
                    }
                }
            ]
          }
        } if ENABLE_ROUTE_SUPPORT_FOR_GEOSPATIAL === 'Y' else undefined %}

        {% set landBoundaryOnAMapElement = {
          key: {
            text: "Land boundary on a map"
          },
          classes: hideClass(documentOrImage) + ' defra-js-show hidden',
          value: {
            html: "<div id=\"map\" data-testid=\"land-boundary-map-value\" class=\"map map--location\" tabindex=\"0\"></div>"
          }
        } if ENABLE_ROUTE_SUPPORT_FOR_GEOSPATIAL === 'Y' else undefined %}

        {{ govukSummaryList({
          classes: "govuk-!-margin-bottom-7",
          rows: [
            landBoundaryUploadTypeElement,
            {
              key: {
                text: "Land boundary file uploaded"
              },
              value: {
                html: "<span data-testid=\"land-boundary-file-name-value\">" + landBoundaryFileName + "</span>"
              },
              actions: {
                items: [
                  {
                    href: checkLandBoundaryLink,
                    text: "Change",
                    visuallyHiddenText: " land boundary file"
                  }
                ]
              }
            },
            landBoundaryOnAMapElement,
            {
              key: {
                text: "Grid reference"
              },
              value: {
                html: "<span data-testid=\"grid-reference-value\">" + gridReference + "</span>"
              },
              actions: {
                items: [
                  {
                    href: routes.ADD_GRID_REFERENCE,
                    text: "Change",
                    visuallyHiddenText: " grid reference",
                    classes: hideClass(geospatial)
                  }
                ]
              }
            },
            {
              key: {
                text: "Area in hectares"
              },
              value: {
                html: "<span data-testid=\"area-in-hectares-value\">" + areaInHectare + "</span>"
              },              
              actions: {
                items: [
                  {
                    href: routes.ADD_HECTARES,
                    text: "Change",
                    visuallyHiddenText: " area in hectares",
                    classes: hideClass(geospatial)
                  }
                ]
              }
            }
          ]
        }) }}

        <!--Land ownership-->
        <h2 class="govuk-heading-l">Land ownership</h2>
        {{ govukSummaryList({
          classes: 'govuk-!-margin-bottom-7',
          rows: [
            {
              key: {
                text: "Proof of land ownership file uploaded"
              },
              value: {
                html: "<span data-testid=\"proof-land-ownership-file-name-value\">" + getFileNameByType(application.files, 'land-ownership') + "</span>"
              },
              actions: {
                items: [
                  {
                    href: routes.CHECK_PROOF_OF_OWNERSHIP,
                    text: "Change",
                    visuallyHiddenText: " land boundary file"
                  }
                ]
              }
            },
            {
              key: {
                text: "Landowner name"
              },
              value: {
                html: "<span data-testid=\"land-owner-names-value\">" + listArray(landownerNames) + "</span>"
              },
              actions: {
                items: [
                  {
                    href: changeLandownersHref,
                    text: "Change",
                    visuallyHiddenText: " landowner name"
                  }
                ]
              }
            },
            {
              key: {
                text: "Landowner consent"
              },
              classes: hideClass(hideConsent),
              value: {
                html: "<span data-testid=\"land-owner-consent-value\">" + boolToYesNo(application.landownerConsent) + "</span>"
              },
              actions: {
                items: [
                  {
                    href: routes.LANDOWNER_CONSENT,
                    text: "Change",
                    visuallyHiddenText: " landowner consent"
                  }
                ]
              }
            }
          ]
        }) }}

        <!--Biodiversity Metric-->
        <h2 class="govuk-heading-l">Biodiversity Metric</h2>

        {{ govukSummaryList({
          classes: 'govuk-!-margin-bottom-7',
          rows: [
            {
              key: {
                text: "Biodiversity Metric file uploaded"
              },
              value: {
                html: "<span data-testid=\"metric-file-name-value\">" + getFileNameByType(application.files, 'metric') + "</span>"
              },
              actions: {
                items: [
                  {
                    href: routes.CHECK_UPLOAD_METRIC,
                    text: "Change",
                    visuallyHiddenText: " Biodiversity Metric file"
                  }
                ]
              }
            }
          ]
        }) }}

        <!--Habitat management and monitoring plan-->
        <h2 class="govuk-heading-l">Habitat management and monitoring</h2>
        {{ govukSummaryList({
          classes: 'govuk-!-margin-bottom-7',
          rows: [
            {
              key: {
                text: "Habitat management and monitoring plan uploaded"
              },
              value: {
                html: "<span data-testid=\"habitat-plan-file-name-value\">" + getFileNameByType(application.files, 'management-plan') + "</span>"
              },
              actions: {
                items: [
                  {
                    href: routes.CHECK_MANAGEMENT_PLAN,
                    text: "Change",
                    visuallyHiddenText: " habitat management and monitoring plan"
                  }
                ]
              }
            },
            {
              key: {
                text: "Start date of the 30 year management and monitoring period"
              },
              value: {
                html: "<span data-testid=\"management-monitoring-start-date-value\">" + dateToString(application.managementMonitoringStartDate) + "</span>"
              },
              actions: {
                items: [
                  {
                    href: routes.MANAGEMENT_MONITORING_START_DATE,
                    text: "Change",
                    visuallyHiddenText: " start date of the 30 year management and monitoring period"
                  }
                ]
              }
            }
          ]
        }) }}

       
        <!-- Legal agreement -->
        <h2 class="govuk-heading-l">Legal information</h2>
        {% set rowList = [] %} 
                    {% set habitatPlanSeperateDocument = habitatPlanSeperateDocumentYesNo == 'No' %}
                    {% 
                        set rowList = [
                        {
                            'text': 'Type of legal agreement',
                            'value': legalAgreementType,
                            'valueDataTestId': 'legal-agreement-type-value',
                            'valueId': 'add-legal-agreement-type-value',
                            'href': '/land/legal-agreement-type',
                            'visuallyHiddenText':  ' type of legal agreement',
                            'classes': 'govuk-!-margin-bottom-7',
                            'show':true
                        },
                        {
                            'text': legalAgreementType +' file uploaded',
                            'value': legalAgreementFileNames,
                            'valueDataTestId': 'legal-agreement-file-name-value',
                            'valueId': 'add-legal-agreement-file-value',
                            'href': '/land/check-you-added-all-legal-files',
                            'visuallyHiddenText':  ' legal agreement file',
                            'classes': 'govuk-!-margin-bottom-7',
                            'show':true
                        },
                        {
                            'text': 'Responsible body',
                            'value': responsibleBodies,
                            'valueDataTestId': 'legal-agreement-responsible-bodies-value',
                            'valueId': 'add-legal-agreement-responsible-bodies-value',
                            'href': '/land/check-responsible-bodies',
                            'visuallyHiddenText':  ' responsible body',
                            'classes': 'govuk-!-margin-bottom-7',
                            'show':true
                        },
                        {
                            'text': 'Landowner',
                            'value': landowners,
                            'valueDataTestId': 'legal-agreement-landowner-value',
                            'valueId': 'add-legal-agreement-landowner-value',
                            'href': '/land/check-landowners',
                            'visuallyHiddenText':  ' landowner',
                            'classes': 'govuk-!-margin-bottom-7',
                            'show':true
                        },
                        {
                            'text': 'Habitat management and monitoring plan included in legal agreement',
                            'value': habitatPlanSeperateDocumentYesNo,
                            'valueDataTestId': 'legal-agreement-habitatplan-type-value',
                            'valueId': 'add-legal-agreement-habitatplan-type-value',
                            'href': '/land/habitat-plan-legal-agreement',
                            'visuallyHiddenText':  ' habitat management plan',
                            'classes': 'govuk-!-margin-bottom-7',
                            'show':true
                        },
                        {
                            'text': 'Habitat management and monitoring plan uploaded',
                            'value': getFileNameByType(application.files, 'habitat-plan'),
                            'valueDataTestId': 'habitat-plan-file-name-value',
                            'valueId': 'add-habitat-plan-file-value',
                            'href': '/land/check-habitat-plan-file',
                            'visuallyHiddenText':  ' habitat management plan file name',
                            'classes': 'govuk-!-margin-bottom-7',
                            'show':habitatPlanSeperateDocument
                        },
                        {
                            'text': 'Habitat enhancement works start date',
                            'value': HabitatWorksStartDate,
                            'valueDataTestId': 'habitat-works-start-date-value',
                            'valueId': 'add-habitat-works-start-date-value',
                            'href': '/land/enhancement-works-start-date',
                            'visuallyHiddenText':  ' enhancement works start date',
                            'classes': 'govuk-!-margin-bottom-7',
                            'show':true
                        },
                        {
                            'text': 'Legal agreement end date',
                            'value': HabitatWorksEndDate,
                            'valueDataTestId': 'habitat-works-end-date-value',
                            'valueId': 'add-habitat-works-end-date-value',
                            'href': '/land/legal-agreement-end-date',
                            'visuallyHiddenText':  ' legal agreement end date',
                            'classes': 'govuk-!-margin-bottom-7',
                            'show':true
                        },
                        {
                          'text': 'Local land charge search certificate file uploaded',
                          'value': getFileNameByType(application.files, 'local-land-charge'),
                          'valueDataTestId': 'local-land-charge-file-name-value',
                          'valueId': 'add-local-land-charge-file-name-value',
                          'href': routes.CHECK_LOCAL_LAND_CHARGE_FILE,
                          'visuallyHiddenText':  ' local land charge file',
                          'classes': 'govuk-!-margin-bottom-7',
                          'show':true
                      }
                        
                    ] %}           
                    {{ generateSummaryList({
                        rows: rowList
                    }) }}

        <h2 class="govuk-heading-l">Submit your biodiversity gain site information</h2>

        <p class="govuk-body">By submitting your information you agree that:</p>
        <ul class="govuk-list govuk-list--bullet">
          <li>it is true, to the best of your knowledge and belief</li>
          <li>you have got, or will get, all consents, licences or other permissions needed to carry out the enhancement works</li>
        </ul>
        <div class="govuk-warning-text">
          <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
          <strong class="govuk-warning-text__text">
            <span class="govuk-warning-text__assistive">Warning</span>
            You may have to pay a fine if you have given false information.
          </strong>
        </div>
        {{ govukButton({
          text: "Confirm and submit",
          attributes: {
            "data-testid": "continue"
          }
        }) }}
      </div>
    </div>
  </div>
{% endblock %}
{% block bodyEnd %}
    {{ super() }}
    {% if geospatial %}
    <script src="{{ assetPath }}/js/checkAndSubmit.js"></script>
    <script>
      const safeMapConfig = {{ mapConfig | dump | safe }}
      checkAndSubmit.initialiseMap(safeMapConfig)
    </script>
    {% endif %}
{% endblock %}