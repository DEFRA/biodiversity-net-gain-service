import { MalwareDetectedError, ThreatScreeningError } from '@defra/bng-errors-lib'
import constants from './constants.js'

const TAG_NAME = 'Malware Scanning scan result'

const fileMalwareCheck = (tags) => {
  if (!tags[TAG_NAME]) {
    throw new ThreatScreeningError(constants.uploadErrors.noFileScanResponse)
  }
  if (tags[TAG_NAME] === 'No threats found') {
    return
  }
  if (tags[TAG_NAME] === 'Malicious') {
    throw new MalwareDetectedError(constants.uploadErrors.threatDetected)
  }
  throw new ThreatScreeningError(`Malware scanning result: ${JSON.stringify(tags)}`)
}

export {
  fileMalwareCheck
}
